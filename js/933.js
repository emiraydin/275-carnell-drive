"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[933],{58933:(e,o,t)=>{t.r(o),t.d(o,{default:()=>D});var i=t(97542),a=t(69170),s=t(12250),n=t(11442),m=t(89553),h=t(32597),r=t(6667),d=t(9037),l=t(18596),c=t(23254),u=t(53954),p=t(49827),g=t(69505),w=t(31546),y=t(6739),Z=t(33585),b=t(61948),z=t(76609);class D extends i.Y{constructor(){super(...arguments),this.name="zoom-controls",this.uhQuality={},this.config={enabled:!0}}async init(e,o){this.config.enabled=!!e.enabled,this.sweepTilingModule=await o.getModuleBySymbol(a.y.SWEEP_PANO),this.config.enabled&&await this.registerControls(o),this.engine=o,this.cameraModule=await o.getModuleBySymbol(a.y.CAMERA),this.cameraData=await o.market.waitForData(d.M),this.viewmodeData=await o.market.waitForData(c.O),this.sweepData=await o.market.waitForData(u.Z),this.bindings.push(o.commandBinder.addBinding(Z.bj,(async e=>this.zoomBy(e.step))),o.commandBinder.addBinding(Z.KB,(async e=>this.zoomBy(-e.step))),o.commandBinder.addBinding(Z.ob,(async()=>this.zoomTo(1))),o.commandBinder.addBinding(Z.ts,(async e=>this.zoomTo(e.value))),o.commandBinder.addBinding(Z._N,(async()=>Promise.resolve(this.getMaxZoomAvailable()))))}async registerControls(e){e.getModuleBySymbol(a.y.INPUT).then((e=>{this.bindings.push(e.registerHandler(s.a,(e=>this.zoomByInput(this.scrollToZoomDelta(e))))),this.bindings.push(e.registerHandler(n.G,(e=>this.zoomByInput(this.pinchToZoomDelta(e))))),this.bindings.push(e.registerHandler(m.e,(e=>this.keyHandler(e))))}))}zoomTo(e){const o=this.cameraData.zoom();if(!this.validateViewmode())return o;const t=this.sweepData.currentSweepObject;if(t&&this.checkTilingZoomLevels(e,t),(e=(0,p.uZ)(e,y.X.minZoom,y.X.maxHighResZoom))!==o){const o=(0,g.ZY)(this.cameraData.baseFovY/e),t=l.oR.near,i=l.oR.far;this.cameraModule.updateCameraProjection((new w.M).makePerspectiveFov(o,this.cameraData.aspect(),t,i))}return this.engine.broadcast(new b.Z(e)),e}checkTilingZoomLevels(e,o){e>=y.X.highResThreshold&&this.zoomedSweep!==o?(this.zoomedSweep=o,this.sweepTilingModule.enableZooming(!0,o).then((e=>{e?this.uhQuality[o.id]=!0:(this.uhQuality[o.id]=!1,this.zoomedSweep=void 0)}))):e<y.X.highResThreshold&&this.zoomedSweep&&this.zoomedSweep===o&&(this.sweepTilingModule.enableZooming(!1,this.zoomedSweep),this.zoomedSweep=void 0)}getMaxZoom(e){return this.uhQuality[null!=e?e:"none"]?y.X.maxHighResZoom:y.X.maxZoom}zoomBy(e){const o=this.cameraData.zoom();return this.validateViewmode()?this.zoomTo(o+e):o}validateViewmode(){return this.viewmodeData.isInside()&&this.cameraData.canTransition()}scrollToZoomDelta(e){return-Math.sign(e.delta.y)*y.X.zoomStep}pinchToZoomDelta(e){return e.pinchDelta*(y.X.maxZoom-y.X.minZoom)}zoomByInput(e){const o=this.cameraData.zoom();if(!this.validateViewmode())return o;const t=this.sweepData.currentSweep,i=(0,p.uZ)(o+e,y.X.minZoom,this.getMaxZoom(t));return this.zoomTo(i)}keyHandler(e){if(e.state===r.M.DOWN)switch(e.key){case h.R.PLUSEQUALS:this.zoomByInput(y.X.zoomStep);break;case h.R.DASHUNDERSCORE:this.zoomByInput(-y.X.zoomStep);break;case h.R.OPENBRACKET:this.zoomTo(1)}}getMaxZoomAvailable(){if(!this.sweepData.currentSweepObject)return y.X.maxZoom;return this.sweepData.currentSweepObject.availableResolution(z.SL.ULTRAHIGH)>=z.SL.ULTRAHIGH?y.X.maxHighResZoom:y.X.maxZoom}}},6739:(e,o,t)=>{t.d(o,{X:()=>i});const i={zoomStep:.1,minZoom:.7,maxZoom:2,maxHighResZoom:3,highResThreshold:1.1}}}]);