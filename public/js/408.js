(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[408],{79307:(e,t,i)=>{"use strict";i.d(t,{$:()=>r});var s=i(12529),n=i(90654),a=i(99623);class r{constructor(e,t=""){this.makeLabel=()=>{const e=new a.b6(Object.assign({},this.textStyle));return e.scaleType=n.N3.WORLD,e.setRenderOrder(s.z.labels),e.setRenderLayer(this.layer),e.opacity=0,e},this.textStyle=n.uc.makeConfig({assetBasePath:t,color:"white",background:!e,backgroundAsCollider:!0,backgroundColliderType:a.Es,backgroundColor:"#222",backgroundOpacity:1,outline:e,outlineWidth:8,backgroundBorderHeight:26,backgroundBorderWidth:20,wordWrapWidth:void 0,disableDepth:!0})}setRenderLayer(e){this.layer=e}}},99623:(e,t,i)=>{"use strict";i.d(t,{BV:()=>a,Es:()=>o,b6:()=>r});var s=i(90654),n=i(81396);const a={ColorDefault:16777215,ColorHovered:i(15462).I.MP_BRAND.getHex(),ColorInvalid:16750933};class r extends s.$7{use(e){this.userData.sid=e.data.sid,this.collider.data=e.data,this.collider.name=e.data.text,this.collider.labelMesh=e}}class o extends n.Mesh{constructor(){super(...arguments),this.hitTest=(()=>{const e=new n.Matrix4,t=new n.Ray,i=new n.Plane(new n.Vector3(0,0,-1)),s=new n.Vector3;return(n,a)=>{if(e.copy(this.matrixWorld).invert(),t.copy(n.ray).applyMatrix4(e),t.intersectPlane(i,s)){const e=this.scale.x/this.scale.y;let t=.5;e<1.5&&(t=1/e),Math.abs(s.x)<=t&&Math.abs(s.y)<=.75&&(s.applyMatrix4(this.matrixWorld),a.push({distance:n.ray.origin.distanceTo(s),point:s.clone(),object:this}))}}})()}labelVisible(){return!(!this.labelMesh||!this.labelMesh.labelVisible())}getId(){if(!this.data)throw new Error("LabelInputCollider used before configure");return this.data.sid}raycast(e,t){if(!this.labelVisible())return;if(this.material.depthTest)return void this.hitTest(e,t);const i=this.material.depthTest?t:[];this.hitTest(e,i),i.length>0&&(i[0].distance/=1e4,t.push(i[0]))}}},96139:(e,t,i)=>{"use strict";i.d(t,{R:()=>n,_:()=>s});const s=30,n={LABEL_SIZE:0,FADE_DURATION:200}},10840:(e,t,i)=>{"use strict";i.d(t,{T:()=>m});var s=i(81396),n=i(11677),a=i(44724),r=i.n(a),o=i(7188),c=i.n(o),l=i(52059),d=i.n(l),h=i(75215),f=i.n(h),u=i(56449),p=i.n(u);const m={endpoint:{uniforms:{opacity:{type:"f",value:1},color:{type:"c",value:new s.Color},bg:{type:"t",value:null}},vertexShader:n.Z.basicTextured.vertexShader,fragmentShader:r()},line:{uniforms:s.UniformsUtils.merge([s.UniformsLib.common,s.UniformsLib.fog,{linewidth:{value:4},resolution:{value:new s.Vector2(0,0)},dashScale:{value:1},dashSize:{value:.025},gapSize:{value:.05},mask:{value:null}}]),vertexShader:c(),fragmentShader:d()},screenline:{uniforms:{lineWidth:{value:1},screenSize:{value:new s.Vector2(0,0)},dashed:{value:0},dashSize:{value:1},gapSize:{value:1},antialiasWidth:{value:1},color:{value:new s.Color(1,0,0)},opacity:{value:1},start:{value:new s.Vector3},end:{value:new s.Vector3}},vertexShader:f(),fragmentShader:p()}}},66990:(e,t,i)=>{"use strict";i.d(t,{Ey:()=>a,V9:()=>n,g4:()=>r,iV:()=>s});const s={FADE_DURATION:300,LABEL_HIDDEN_OPACITY:.15,DEPTH_WRITE_THRESHOD:.15,ALIGN_LABELS:!1,LABEL_SIZING:.14,LABEL_NDC_SCALEFACTOR:.5,LABEL_ASPECT_SCALEFACTOR:.035,OFFSET_TOWARDS_CAMERA:.25,HIDE_LABELS:!1},n={dottedLineDefault:2,lineDefault:6,lineSelected:6,endpointDefault:2.5,endpointSelected:3.75},a=.01,r=5},50190:(e,t,i)=>{"use strict";i.d(t,{H:()=>v,m:()=>g});var s=i(81396),n=i(49827),a=i(67944),r=i(31546),o=i(59370),c=i(72119),l=i(66990),d=i(90304),h=i(86819),f=i(23612),u=i(72996),p=i(20341),m=i(34956);class v extends s.Mesh{}class g{constructor(e,t,i,n,a,o,c,l,d,f,m){this.points=e,this.input=t,this.mobile=i,this.cameraData=n,this.renderLayer=a,this.renderOrder=o,this.textRenderer=c,this.getLineDetails=l,this.changeCursor=d,this.getPhase=f,this.setSelectedLine=m,this.meshPool=[],this.textContainer=new s.Object3D,this.textGeometry=new s.PlaneGeometry(1,1),this.tmpMidpoint=new s.Vector3,this.tmpCamPos=new s.Vector3,this.cameraRotation=new s.Quaternion,this.cameraProjection=new r.M,this.cameraPosition=new s.Vector3;this.inputSubs=[this.input.registerMeshHandler(h.R,u.s.isType(v),((e,t)=>{var i,s;if(this.getPhase()===p.au.IDLE)return this.setSelectedLine(null===(s=null===(i=null==t?void 0:t.parent)||void 0===i?void 0:i.userData)||void 0===s?void 0:s.groupIndex),!0}))],this.mobile||this.inputSubs.push(...this.registerHoverHandlers()),this.deactivate(),this.deactivateInteraction()}registerHoverHandlers(){return[this.input.registerMeshHandler(f.z,u.s.isType(v),(()=>{this.getPhase()===p.au.IDLE&&this.changeCursor(m.C.FINGER)})),this.input.registerMeshHandler(f.A,u.s.isType(v),(()=>{this.changeCursor(m.C.DEFAULT)}))]}reset(){for(const e of this.meshPool)e&&(this.input.unregisterMesh(e.collider),this.textContainer.remove(e));this.meshPool=[]}init(){}dispose(){this.textGeometry.dispose()}activate(){}deactivate(){this.reset()}activateInteraction(){for(const e of this.inputSubs)e.renew()}deactivateInteraction(){for(const e of this.inputSubs)e.cancel()}get container(){return this.textContainer}beforeRender(){const e=this.cameraData.pose;this.cameraRotation.copy(e.rotation),this.cameraPosition.copy(e.position),this.cameraProjection.copy(e.projection);const t=(0,a.s1)(this.cameraProjection),i=(0,a.Pp)(this.cameraProjection),s=this.cameraData.height,r=this.cameraData.zoom(),l=this.cameraData.aspect();for(let e=1;e<this.points.length;++e){const d=e-1,h=this.points.groupFromPointIndex(e),f=this.getLineDetails(h,d,e);if(!f||h!==this.points.groupFromPointIndex(d)){this.removeLabelMesh(e);continue}const u=this.points.get(d),p=this.points.get(e),m=this.setMeshVisible(e,f.labelVisible);if(!m)continue;m.text!==f.labelContents&&(m.text=f.labelContents);const v=this.cameraPosition.distanceTo(m.position);if(this.updateMeshPose(m,u,p,this.cameraRotation,this.cameraPosition,v,f.rotation,i),i||t)m.scaleFactor=c.Hn.SCALE_DISTANCE*r;else{const e=(0,o.D_)(m.position,this.cameraPosition,this.cameraRotation,this.cameraProjection.asThreeMatrix4()),t=Math.abs(e.x);if(t<1){const e=(0,a.mY)(this.cameraProjection,this.cameraPosition,m.position,s,c.Hn.SCALE),i=((0,n.uZ)(l,1,2.5)+r)*c.Hn.SCALE_ASPECT,o=1+c.Hn.SCALE_NDC-t*c.Hn.SCALE_NDC-i;m.scaleFactor=Math.max(Math.min(1/e*o,3),.001)}else m.scaleFactor=.001}}for(let e=this.points.length;e<this.meshPool.length;e++)this.removeLabelMesh(e);this.meshPool=this.meshPool.slice(0,this.points.length)}setTextOpacityByPoint(e,t){const i=this.meshPool[e];i&&(i.opacity=t)}updateMeshPose(e,t,i,s,n,a,r,o){this.tmpMidpoint.copy(t).add(i).multiplyScalar(.5);const c=o?e=>this.tmpCamPos.copy(e).addScaledVector(d.fU.UP,.15):e=>this.tmpCamPos.copy(n).sub(e).setLength(.15*a).add(e);e.setPosition(this.tmpMidpoint,c),e.setOrientation(s,r)}render(){}setMeshVisible(e,t){let i=this.meshPool[e];if(!i&&t){i=this.textRenderer.createLabel(),i.setRenderLayer(this.renderLayer),i.renderOrder=this.renderOrder,i.opacity=1,i.visible=!1;const t=this.points.groupFromPointIndex(e);i.userData.groupIndex=t,this.textContainer.add(i),this.input.registerMesh(i.collider,!1),this.meshPool[e]=i}if(i){const e=t?.001:l.iV.LABEL_HIDDEN_OPACITY;if(i.visible=i.opacity>e,!i.visible)return null}return i}removeLabelMesh(e){const t=this.meshPool[e];t&&(this.textContainer.remove(t),t.dispose(),this.input.unregisterMesh(t.collider),this.meshPool[e]=null)}}},72119:(e,t,i)=>{"use strict";i.d(t,{E0:()=>r,Hn:()=>h,NZ:()=>a,Nz:()=>u,Oq:()=>d,Ql:()=>f,X7:()=>c,ox:()=>o,xh:()=>l,yV:()=>n});var s=i(83402);const n=.01,a=.001,r=!0,o={highResThreshold:1081,desktopSize:192,desktopSizeHighRes:320,mobileSize:128},c={smoothness:.4,perspective:{fov:40,thresholdClose:1,thresholdFar:8,offsetClose:.25,offsetFar:.5,scale:1},ortho:{fov:5,thresholdClose:5,thresholdFar:20,offsetClose:15,offsetFar:30,scale:4}},l={desktop:s.l1.Edges,floorplan:s.l1.Axes,mobile:s.l1.Edges,alt:s.l1.Free,shift:s.l1.PlanarAxes,shiftAlt:s.l1.EdgesAndPlanarAxes,disabled:s.l1.Free},d={mobile:.15,desktop:.1},h={SCALE:.1,SCALE_NDC:.5,SCALE_ASPECT:.035,SCALE_DISTANCE:.025},f="measurements",u=24},38987:(e,t,i)=>{"use strict";i.d(t,{u:()=>n});var s=i(19663);class n extends s.m{constructor(e=null){super(),this.id="SET_MOUSE_CURSOR",this.payload={cursor:e}}}},34956:(e,t,i)=>{"use strict";var s;i.d(t,{C:()=>s}),function(e){e.NONE="none",e.DEFAULT="default",e.MOVE="move",e.MOVE_LF="col-resize",e.MOVE_UD="row-resize",e.XHAIR="crosshair",e.PLUS="cell",e.QUESTION="help",e.NOPE="not-allowed",e.FINGER="pointer",e.TEXT="text",e.TEXT_VERT="vertical-text",e.ZOOM_IN="zoom-in",e.ZOOM_OUT="zoom-in",e.GRAB="grab",e.GRABBING="grabbing",e.ARROW_R="e-resize",e.ARROW_L="w-resize",e.ARROW_U="n-resize",e.ARROW_D="s-resize",e.ARROW_UR="ne-resize",e.ARROW_UL="nw-resize",e.ARROW_DR="se-resize",e.ARROW_DL="sw-resize",e.ARROW_LR="ew-resize",e.ARROW_UD="ns-resize",e.ARROW_URDL="nesw-resize",e.ARROW_ULDR="nwse-resize",e.ROOMBOUNDS_DEFAULT="rbe-default",e.ROOMBOUNDS_MOVING="rbe-moving",e.ROOMBOUNDS_PLACE_NODE="rbe-place-node",e.ROOMBOUNDS_FINISH_ROOM="rbe-finish-room"}(s||(s={}))},56163:(e,t,i)=>{"use strict";i.d(t,{K:()=>o});var s=i(52528),n=i(71166),a=i(63319);const r=new s.v({});class o{constructor(e,t,i){this.commandBinder=e,this.layersData=t,this.dataTypeGroup=i,this.textParser=r,this.enabled=!0,this.bindings=[]}getGroupingId(e){switch(e){case a.HH.TYPE:return this.getTypeId();case a.HH.FLOOR:return this.getFloorId();case a.HH.ROOM:return this.getRoomId();case a.HH.LAYER:return this.getLayerGroupId();case a.HH.DATE:return this.dateBucket}}getFloorId(){return this.floorId}getRoomId(){return this.roomId}getDateBucket(){return this.dateBucket}getTypeId(){return this.typeId}supportsBatchDelete(){return!1}supportsLayeredCopyMove(){return!1}getLayerGroupId(){var e,t;const i=null===(e=this.layersData)||void 0===e?void 0:e.getBaseLayerId(),s=null===(t=this.layersData)||void 0===t?void 0:t.getViewLayerId();return this.layerId&&s&&this.layerId===i?s:this.layerId}isLayerVisible(){return!this.layersData||!this.layerId||this.layersData.layerVisible(this.layerId)}onSelect(e,t,i){this.commandBinder.issueCommand(new n.IL(this.id,this.typeId))}registerBindings(){}cancelBindings(){this.bindings.forEach((e=>e.cancel()))}}},94046:(e,t,i)=>{"use strict";i.d(t,{i:()=>n});var s=i(81396);class n extends s.Mesh{}},83402:(e,t,i)=>{"use strict";i.d(t,{l1:()=>r,r2:()=>l});var s=i(81396),n=i(69505),a=i(90304);var r;!function(e){e[e.Axes=1]="Axes",e[e.PlanarAxes=2]="PlanarAxes",e[e.EdgesAndPlanarAxes=3]="EdgesAndPlanarAxes",e[e.Edges=4]="Edges",e[e.Free=5]="Free",e[e.Locked=6]="Locked"}(r||(r={}));const o={[a.eD.UP]:{dir:Object.freeze(a.fU.UP.clone())},[a.eD.DOWN]:{dir:Object.freeze(a.fU.DOWN.clone())},[a.eD.BACK]:{dir:Object.freeze(a.fU.BACK.clone())},[a.eD.LEFT]:{dir:Object.freeze(a.fU.LEFT.clone())},[a.eD.RIGHT]:{dir:Object.freeze(a.fU.RIGHT.clone())},[a.eD.FORWARD]:{dir:Object.freeze(a.fU.FORWARD.clone())}},c={[a.eD.HORIZONTAL_PLANE]:{dir:Object.freeze(a.fU.HORIZONTAL_PLANE.clone())}},l=(()=>{let e=0;const t=new s.Vector3,i=new s.Vector3,l=new s.Vector3,d=new s.Vector3,h=999,f=Object.freeze(a.fU.ZERO.clone()),u=Object.keys(o).map((e=>Object.assign(Object.assign({},o[e]),{name:e,angleTo:h}))),p=Object.keys(c).map((e=>Object.assign(Object.assign({},c[e]),{name:e,angleTo:h}))),m=e=>(e+3)%2;let v=u[0];return(s,o,c=r.Axes)=>{if(c===r.Free)return{position:o.clone(),constrainedAxis:f,axisName:a.eD.NONE};if(u.forEach((e=>e.angleTo=h)),p.forEach((e=>e.angleTo=h)),l.copy(o).sub(s),e=l.length(),e<.05)return{position:o.clone(),constrainedAxis:f,axisName:a.eD.NONE};d.copy(l).normalize();const g=.05*Math.min(e,1);if(c!==r.Locked){for(const e of u){const t=(0,n.ZY)(d.angleTo(e.dir));t<v.angleTo&&(v=e),e.angleTo=t}if(v.angleTo>20){const e=Math.abs(l.y);e*e<g&&(v=p[0])}}t.set(s.x*m(v.dir.x),s.y*m(v.dir.y),s.z*m(v.dir.z)),i.set(o.x*Math.abs(v.dir.x),o.y*Math.abs(v.dir.y),o.z*Math.abs(v.dir.z)).add(t);return c===r.Locked||i.distanceToSquared(o)<g?{position:i.clone(),constrainedAxis:v.dir,axisName:v.name}:{position:o.clone(),constrainedAxis:f,axisName:a.eD.NONE}}})()},44724:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform float opacity;uniform vec3 color;uniform sampler2D bg;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);gl_FragColor=vec4(bgColor.rgb,bgColor.a*opacity);}"},52059:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform vec3 diffuse;uniform float opacity;uniform sampler2D mask;\n#ifdef USE_DASH\nuniform float dashSize;uniform float gapSize;\n#endif\nvarying float vLineDistance;\n#include <common>\nvarying vec2 vUv;void main(){\n#ifdef USE_DASH\nif(vUv.y<-1.||vUv.y>1.)discard;if(mod(vLineDistance,dashSize+gapSize)>dashSize)discard;\n#endif\n#ifdef USE_MASK\nvec2 modUv=vec2(vUv);modUv*=2.;vec4 texelColor=texture2D(mask,modUv);gl_FragColor=vec4(texelColor.rgb,min(texelColor.a,opacity));\n#else\ngl_FragColor=vec4(diffuse,opacity);\n#endif\n}"},7188:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;\n#include <common>\nuniform float linewidth;uniform vec2 resolution;attribute vec3 instanceStart;attribute vec3 instanceEnd;attribute vec3 instanceColorStart;attribute vec3 instanceColorEnd;varying vec2 vUv;\n#ifdef USE_DASH\nuniform float dashScale;attribute float instanceDistanceStart;attribute float instanceDistanceEnd;varying float vLineDistance;\n#endif\nvoid trimSegment(const in vec4 start,inout vec4 end){float a=projectionMatrix[2][2];float b=projectionMatrix[3][2];float nearEstimate=-0.5*b/a;float alpha=(nearEstimate-start.z)/(end.z-start.z);end.xyz=mix(start.xyz,end.xyz,alpha);}void main(){\n#ifdef USE_COLOR\nvColor.xyz=(position.y<0.5)?instanceColorStart:instanceColorEnd;\n#endif\n#ifdef USE_DASH\nvLineDistance=(position.y<0.5)?dashScale*instanceDistanceStart:dashScale*instanceDistanceEnd;\n#endif\nfloat aspect=resolution.x/resolution.y;vUv=uv;vec4 start=modelViewMatrix*vec4(instanceStart,1.);vec4 end=modelViewMatrix*vec4(instanceEnd,1.);bool perspective=(projectionMatrix[2][3]==-1.);if(perspective){if(start.z<0.&&end.z>=0.){trimSegment(start,end);}else if(end.z<0.&&start.z>=0.){trimSegment(end,start);}}vec4 clipStart=projectionMatrix*start;vec4 clipEnd=projectionMatrix*end;vec2 ndcStart=clipStart.xy/clipStart.w;vec2 ndcEnd=clipEnd.xy/clipEnd.w;vec2 dir=ndcEnd-ndcStart;dir.x*=aspect;dir=normalize(dir);vec2 offset=vec2(dir.y,-dir.x);dir.x/=aspect;offset.x/=aspect;if(position.x<0.)offset*=-1.;offset*=linewidth;offset/=resolution.y;vec4 clip=(position.y<0.5)?clipStart:clipEnd;\n#ifdef USE_MASK\noffset*=(clipEnd.w+clipStart.w)*0.5;\n#else\noffset*=clip.w;\n#endif\nclip.xy+=offset;gl_Position=clip;\n#include <worldpos_vertex>\n}"},56449:e=>{e.exports="precision highp float;uniform vec3 color;uniform float antialiasWidth;uniform float lineWidth;uniform float dashed;uniform float dashSize;uniform float gapSize;uniform float opacity;varying float vDistanceFromAxis;varying float vDistanceAlong;void main(){float halfWidth=lineWidth*0.5;float antialiasing=1.-smoothstep(halfWidth,halfWidth+antialiasWidth,vDistanceFromAxis);float dashOpacity=1.;if(dashed>0.){\n#ifdef WORLDSPACE_DASH\nfloat dashAA=fwidth(vDistanceAlong)*antialiasWidth*0.5;\n#else\nfloat dashAA=antialiasWidth*0.5;\n#endif\nfloat dashT=mod(vDistanceAlong,dashSize+gapSize);dashOpacity=smoothstep(0.,dashAA,dashT)*(1.-smoothstep(dashSize-dashAA,dashSize,dashT));}gl_FragColor=vec4(color,opacity*dashOpacity*antialiasing);}"},75215:e=>{e.exports="precision highp float;uniform vec3 start;uniform vec3 end;uniform float lineWidth;uniform float antialiasWidth;uniform vec2 screenSize;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;attribute float offsetDirection;attribute float t;varying float vDistanceFromAxis;varying float vDistanceAlong;vec2 rotate90(vec2 v){return vec2(-v.y,v.x);}vec2 ndcToScreen(vec4 pt){return pt.xy*screenSize/2.;}vec2 screenToNdc(vec2 pt){return pt*2./screenSize;}void main(){vec4 startNdc=projectionMatrix*modelViewMatrix*vec4(start,1.);vec4 endNdc=projectionMatrix*modelViewMatrix*vec4(end,1.);float z=mix(startNdc.z,endNdc.z,t);float w=mix(startNdc.w,endNdc.w,t);vec2 startScreen=ndcToScreen(startNdc/startNdc.w);vec2 endScreen=ndcToScreen(endNdc/endNdc.w);float halfWidth=lineWidth*0.5+antialiasWidth;vec2 directionScreen=endScreen-startScreen;vec2 widthOffsetScreen=rotate90(normalize(directionScreen))*offsetDirection*halfWidth;vec2 position=startScreen+directionScreen*t+widthOffsetScreen;vDistanceFromAxis=length(widthOffsetScreen);\n#ifdef WORLDSPACE_DASH\nvDistanceAlong=length((end-start)*t);\n#else\nvDistanceAlong=length(directionScreen*t);\n#endif\nvec2 posNdc=screenToNdc(position);gl_Position=vec4(posNdc*w,z,w);}"}}]);